<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Test Downloads</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/html-to-docx@1.8.0/dist/html-to-docx.js"></script>
    <style>
        /* Copy the resume styles */
        .resume-layout {
          width: 100%;
          height: 100%;
          border-collapse: collapse;
          font-family: 'Segoe UI', 'Tahoma', 'Geneva', 'Verdana', sans-serif;
        }
        
        /* Left Column: Skills & Education */
        .left-column {
          width: 33%;
          background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
          color: white;
          vertical-align: top;
          padding: 0.6in 0.5in;
        }
        .left-column h2 {
          font-family: 'Segoe UI', sans-serif;
          font-size: 0.95rem;
          font-weight: bold;
          margin-top: 1rem;
          margin-bottom: 0.1rem;
          color: white;
        }
        .left-column p {
          font-size: 0.9rem;
          line-height: 1.5;
          margin-bottom: 0.5rem;
          color: #f0f0f0;
        }
        .left-column p strong {
          color: white;
        }

        /* Right Column: Main Content */
        .right-column {
          width: 67%;
          vertical-align: top;
          padding: 0.6in 0.7in;
        }
        .right-column h1 { /* Candidate Name */
          font-family: 'Garamond', 'Times New Roman', Times, serif;
          font-size: 2.8rem;
          font-weight: 600;
          color: #2d3748;
          margin: 0;
          padding: 0;
        }
        .right-column h1 + p { /* Contact Info */
          font-size: 0.9rem;
          color: #4a5568;
          margin: 0.25rem 0 2rem 0;
        }
        .right-column h2 { /* Section Titles */
          font-family: 'Segoe UI', sans-serif;
          font-size: 1rem;
          font-weight: bold;
          color: #4a90e2;
          border-bottom: 2px solid #e2e8f0;
          padding-bottom: 0.3rem;
          margin-top: 1.5rem;
          margin-bottom: 1rem;
          text-transform: uppercase;
          letter-spacing: 0.1em;
        }
        .right-column h2:first-of-type {
          margin-top: 0;
        }
        .right-column h3 { /* Job Titles */
          font-size: 1.05rem;
          font-weight: 600;
          color: #2d3748;
          margin-top: 1.2rem;
          margin-bottom: 0.15rem;
        }
        .right-column p { /* Body Text */
          font-size: 0.9rem;
          line-height: 1.6;
          color: #4a5568;
          margin-bottom: 0.8rem;
        }
        .right-column ul {
          margin: 0.5rem 0;
          padding-left: 1.2rem;
        }
        .right-column li {
          font-size: 0.9rem;
          line-height: 1.5;
          color: #4a5568;
          margin-bottom: 0.4rem;
        }
    </style>
</head>
<body>
    <h1>Download Test</h1>
    
    <div id="resume-content">
        <table class="resume-layout">
          <tbody>
            <tr>
              <td class="left-column">
                <h2>Skills</h2>
                <p><strong>Technical Skills:</strong> JavaScript (ES6+), TypeScript, React, Node.js, HTML5, CSS3, SQL, NoSQL, AWS</p>
                <p><strong>Soft Skills:</strong> Agile Methodologies, Problem Solving, Team Collaboration, Communication</p>
                
                <h2>Education</h2>
                <div>
                  <h3>B.S. in Computer Science</h3>
                  <p><strong>State University</strong></p>
                  <p>Anytown, USA</p>
                  <p>Graduated May 2020</p>
                </div>
              </td>
              <td class="right-column">
                <h1>Jane Doe</h1>
                <p>555-555-5555 | jane.doe@email.com | linkedin.com/in/janedoe</p>

                <h2>Summary</h2>
                <p>Results-driven Software Engineer with 4+ years of experience in developing, testing, and maintaining web applications. Proficient in JavaScript, React, and Node.js, with a passion for creating intuitive user experiences.</p>

                <h2>Experience</h2>
                <div>
                  <h3>Software Engineer</h3>
                  <p><strong>Tech Solutions Inc.</strong> | Anytown, USA | June 2020 – Present</p>
                  <ul>
                    <li>Developed and maintained client-side applications using React, resulting in a 20% increase in user engagement.</li>
                    <li>Collaborated with a team of 5 engineers to build and deploy new features on a weekly basis.</li>
                    <li>Wrote unit and integration tests to ensure code quality and maintainability.</li>
                  </ul>
                </div>
                <div>
                  <h3>Software Engineer Intern</h3>
                  <p><strong>Innovate Corp.</strong> | Anytown, USA | May 2019 – August 2019</p>
                  <ul>
                    <li>Assisted in the development of a new REST API using Node.js and Express.</li>
                    <li>Participated in code reviews and agile ceremonies.</li>
                  </ul>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
    </div>

    <button onclick="testPdf()">Test PDF Download</button>
    <button onclick="testRtf()">Test RTF Download</button>
    <button onclick="testWordHtml()">Test Word HTML Download</button>

    <script>
        function testPdf() {
            const resumeContent = document.getElementById('resume-content');
            const opt = {
                margin: [10, 10, 10, 10],
                filename: 'TestResume.pdf',
                image: { type: 'jpeg', quality: 0.98 },
                html2canvas: {
                    scale: 2,
                    useCORS: true,
                    allowTaint: true,
                    backgroundColor: '#ffffff',
                    logging: true,
                    letterRendering: true
                },
                jsPDF: { 
                    unit: 'pt', 
                    format: 'letter', 
                    orientation: 'portrait',
                    compress: false
                }
            };
            
            html2pdf().set(opt).from(resumeContent).save().then(() => {
                console.log('PDF generated successfully');
            }).catch(err => {
                console.error('PDF generation failed:', err);
            });
        }

        function testRtf() {
            const resumeContent = document.getElementById('resume-content');
            const html = resumeContent.innerHTML;
            
            // Convert HTML to RTF
            const rtfContent = convertHtmlToRtf(html);
            console.log('Generated RTF content:', rtfContent);
            
            const blob = new Blob([rtfContent], { type: 'application/rtf' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'TestResume.rtf';
            a.click();
            URL.revokeObjectURL(url);
        }

        function testWordHtml() {
            const resumeContent = document.getElementById('resume-content');
            let html = resumeContent.innerHTML;
            
            // Clean HTML for Word
            html = html.replace(/<table[^>]*class="resume-layout"[^>]*>/g, '<div class="resume-layout">');
            html = html.replace(/<\/table>/g, '</div>');
            html = html.replace(/<tbody[^>]*>/g, '');
            html = html.replace(/<\/tbody>/g, '');
            html = html.replace(/<tr[^>]*>/g, '');
            html = html.replace(/<\/tr>/g, '');
            html = html.replace(/<td class="left-column"[^>]*>/g, '<div class="left-section">');
            html = html.replace(/<td class="right-column"[^>]*>/g, '<div class="right-section">');
            html = html.replace(/<\/td>/g, '</div>');
            
            const cleanHtml = `<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <style>
        body { font-family: Calibri, Arial, sans-serif; margin: 0.5in; line-height: 1.15; }
        h1 { font-size: 24pt; color: #2d3748; margin-bottom: 0.2in; font-weight: bold; }
        h2 { font-size: 14pt; color: #4a90e2; margin-top: 0.3in; margin-bottom: 0.15in; text-transform: uppercase; font-weight: bold; }
        h3 { font-size: 12pt; font-weight: bold; margin-top: 0.2in; margin-bottom: 0.05in; }
        p { font-size: 11pt; margin-bottom: 0.1in; line-height: 1.2; }
        ul { margin: 0.1in 0; padding-left: 0.3in; }
        li { margin-bottom: 0.05in; font-size: 11pt; line-height: 1.2; }
        .left-section { margin-bottom: 0.3in; padding: 0.2in; background-color: #f8f9fa; }
        .right-section { margin-bottom: 0.2in; }
        strong { font-weight: bold; }
    </style>
</head>
<body>
    ${html}
</body>
</html>`;
            
            const blob = new Blob([cleanHtml], { type: 'application/msword' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'TestResume.doc';
            a.click();
            URL.revokeObjectURL(url);
        }

        function convertHtmlToRtf(html) {
            const temp = document.createElement('div');
            temp.innerHTML = html;
            
            let rtfContent = '{\\rtf1\\ansi\\deff0 {\\fonttbl {\\f0 Times New Roman;}{\\f1 Arial;}}\\f0\\fs24 ';
            
            const processElement = (element) => {
                const tagName = element.tagName?.toLowerCase();
                const text = element.textContent?.trim() || '';
                
                if (!text && !['table', 'tbody', 'tr', 'td'].includes(tagName)) {
                    return;
                }
                
                switch (tagName) {
                    case 'h1':
                        rtfContent += `\\b\\fs36 ${text}\\b0\\fs24\\par\\par `;
                        break;
                    case 'h2':
                        rtfContent += `\\b\\fs28 ${text}\\b0\\fs24\\par `;
                        break;
                    case 'h3':
                        rtfContent += `\\b\\fs24 ${text}\\b0\\fs24\\par `;
                        break;
                    case 'p':
                        if (text) {
                            rtfContent += `${text}\\par `;
                        }
                        break;
                    case 'ul':
                    case 'ol':
                        const items = element.querySelectorAll('li');
                        items.forEach(item => {
                            const itemText = item.textContent?.trim() || '';
                            if (itemText) {
                                rtfContent += `\\bullet ${itemText}\\par `;
                            }
                        });
                        break;
                    case 'strong':
                    case 'b':
                        rtfContent += `\\b${text}\\b0 `;
                        break;
                    case 'em':
                    case 'i':
                        rtfContent += `\\i${text}\\i0 `;
                        break;
                    case 'table':
                    case 'tbody':
                        Array.from(element.children).forEach(child => processElement(child));
                        break;
                    case 'tr':
                        Array.from(element.children).forEach(child => processElement(child));
                        rtfContent += '\\par ';
                        break;
                    case 'td':
                        if (element.children.length > 0) {
                            Array.from(element.children).forEach(child => processElement(child));
                        } else if (text) {
                            rtfContent += `${text} `;
                        }
                        break;
                    default:
                        if (element.children.length > 0) {
                            Array.from(element.children).forEach(child => processElement(child));
                        } else if (text && !['script', 'style'].includes(tagName)) {
                            rtfContent += `${text} `;
                        }
                        break;
                }
            };
            
            Array.from(temp.children).forEach(child => processElement(child));
            rtfContent += '}';
            return rtfContent;
        }
    </script>
</body>
</html>